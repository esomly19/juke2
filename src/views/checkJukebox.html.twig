{% include 'layout.html.twig' %}
  {% block stylesheets %}
   <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
      <link rel="stylesheet" href="src/views/css/accueil_css.css">
       <link
          rel="stylesheet"
          href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"
          integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
          crossorigin=""
        />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.js"></script>
<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<script src="src/views/css/accueil_css.css"></script>

   <!-- Nous chargeons les fichiers CDN de Leaflet. Le CSS AVANT le JS -->
        <link
          rel="stylesheet"
          href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"
          integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
          crossorigin=""
        />
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
  integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
  crossorigin="" />
<script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
  integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
  crossorigin=""></script>
 <!-- Fichiers Javascript -->
<script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
  integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew==" crossorigin=""></script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"   integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="  crossorigin=""></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<!-- Fin Fchiers Javascript -->

  <style type="text/css">
          #map {
            /* la carte DOIT avoir une hauteur sinon elle n'apparaît pas */
            height: 600px;
          } 
        .container{
width:95%;
}


        </style>
        {% endblock %}

  <div class="row">
  <div class="col-6">
  <div id="map" >
          <!-- Ici s'affichera la carte -->
        </div>  </div>

    <div class="col-6">
<div class="overflow-auto">
        <table class="table  table-hover">
  <thead>
    <tr>
      <th scope="col">Nom établissement</th>
      <th scope="col"></th>
      <th scope="col">Nom jukebox</th>
      <th scope="col"></th>
      <th scope="col">Etat</th>
 <th scope="col"></th>
      <th scope="col">Nom du propriétaire</th>
 <th scope="col"></th>
      <th scope="col">Adresse du établissement</th>
 <th scope="col"></th>
 <th scope="col"></th>
 <th scope="col"></th>
 <th scope="col"></th>
    </tr>
  </thead>
  <tbody>
   

  {% for juke in juke %}
  <tr>

    <td>{{juke.nom_etab}}<td>
    <td>{{juke.nom}}<td>
               {% if juke.etat == 1 %}
    <td class="bg-success"> <td>
      {% elseif juke.etat == 0 %}
    <td class="bg-warning"> <td>
             {% elseif juke.etat == 2 %}
    <td class="bg-danger"> <td>
              {% endif %}
    <td>{{juke.nom_proprio}} {{juke.prenom}} <td>
      <td>{{juke.adresse_etab}} <td>
             <td ><a href="{{ path_for('updateJukebox', { 'id': juke.id }) }}"><img src="src/views/img/edit.png" alt="edit"></a> <td>
     <td >  <a href="{{ path_for('supprimer', { 'id': juke.id }) }}"><img src="src/views/img/bin.png" alt="bin"></<img> </a><td>
      <div id="app"> <td  onclick="on()" > <img src="src/views/img/scan.png" alt="qrcode"></<img> <td>
   <td onclick='ok("{{juke.adresse_etab}}","{{juke.nom}}")'> <img src="src/views/img/place.png" alt="place"></<img> <td></tr> 
<div id="overlay" onclick="off()">
<div  onload='createQR("https://projetjukebox.herokuapp.com/")'><img width="256px" src="src/views/svg/QR_icon.svg" alt="QR_icon"></div>
 <!-- <div  onload="createQR({{juke.id}})"><img width="256px" src="src/views/svg/QR_icon.svg" alt="QR_icon"></div>-->
</div>
</div>
   {% endfor %}
<tr>
<td><td>
<td><td>
<td><td> 
<td ><a href="{{ path_for('ajouterJukebox')}}"><img src="src/views/img/plus.png" alt="plus"></a><td>
<td><td>
<td><td>
</tr>
</a>
  </tbody>
</table> 
 </div>
</div>
</div>
  
<footer class="footer">
    <div class="container">
                Site crée par Thomas Farruggia, Théo Fraschini, Lucas Ligerot, Victor Vancoille  ©	
    </div>
</footer>

{% block script %}
 <script src="src/views/js/jQuery.js"></script>
  <script src="src/views/js/qrcode.min.js"></script>
  <script src="src/views/js/vue.js"></script>
  <script src="src/views/js/app.js"></script>
<script>
function on() {
  document.getElementById("overlay").style.display = "block";
}

function off() {
  document.getElementById("overlay").style.display = "none";
}
</script>
<script>
// On initialise la latitude et la longitude de Paris (centre de la carte)
var lat = 48.690920;
var lon = 6.179254;

var macarte = null;
// Fonction d'initialisation de la carte
 
   

function removeExtraSpace(str)
{
    str = str.replace(/[\s]{2,}/g," "); // Enlève les espaces doubles, triples, etc.
    str = str.replace(/^[\s]/, ""); // Enlève les espaces au début
    str = str.replace(/[\s]$/,""); // Enlève les espaces à la fin
    return str;    
}

function initMap() {


   macarte = L.map("map").setView([lat, lon], 11);

  // Leaflet ne récupère pas les cartes (tiles) sur un serveur par défaut. Nous devons lui préciser où nous souhaitons les récupérer. Ici, openstreetmap.fr
  L.tileLayer("https://{s}.tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png", {
    // Il est toujours bien de laisser le lien vers la source des données
    attribution:
      'données © <a href="//osm.org/copyright">OpenStreetMap</a>/ODbL - rendu <a href="//openstreetmap.fr">OSM France</a>',
    minZoom: 14.5,
    maxZoom: 20
  }).addTo(macarte); // Créer l'objet "macarte" et l'insèrer dans l'élément HTML qui a l'ID "map"
 
 

 
}
function getRandomColor() {
  var letters = '0123456789ABCDEF';
  var color = '#';
  for (var i = 0; i < 6; i++) {
    color += letters[Math.floor(Math.random() * 16)];
  }
  return color;
}
function ok(element,name) {


$.get(location.protocol + '//nominatim.openstreetmap.org/search?format=json&q='+element, function(data){
var polygon1 = L.circle([ removeExtraSpace(data[0].lat),  removeExtraSpace(data[0].lon)], {
    color: getRandomColor(),
    fillColor: getRandomColor(),
    fillOpacity: 0.5,
    radius: 35
  }).addTo(macarte);
 polygon1.bindPopup(name);
    });
} 
window.onload = function() {
  // Fonction d'initialisation qui s'exécute lorsque le DOM est chargé
  initMap();
};


</script>
        {% endblock %}